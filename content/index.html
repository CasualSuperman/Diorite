<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="utf-8">
	<title>Diorite</title>
	<link rel="stylesheet/less" type="text/css" href="main.less">
	<script src="less.js"></script>
	<script src="prefixfree.min.js"></script>
	<script src="gs/gs.js"></script>
	<script>
	var gs = new GoSocket(window.location.host + "/gs/");
	</script>
	<link rel="import" href="elements/card.html" />
</head>
<body>
<template id="mtg_card">
	<style scoped>
	@host { * {
		border: 0.5em solid black;
		border-radius: 0.5em;
		display: inline-block;
	} }
	.rulestext {
		text-align: center;
	}
	.cost, .set {
		float: right;
	}
	</style>
	<div class="namebar">
		<span class="name">Cancel</span>
		<span class="cost">1UU</span>
	</div>
	<img src="notfound.jpg" class="art" />
	<div class="typebar">
		<span class="supertypes"></span>
		<span class="types">Instant</span>
		<span class="subtypes"></span>
		<img class="set" src="sets/m14.jpg" />
	</div>
	<div class="textblock">
		<div class="rulestext">
			<p>Counter target spell.</p>
		</div>
		<div class="flavortext">
		</div>
	</div>
	<div class="metabar">
		<span class="artist">David Palumbo</span>
		<br />
		<span class="copyright">&trade; &amp; &copy; 2013 Wixards of the Coast</span>
		<span class="setnumber">45/249</span>
	</div>
</template>

<header>
	<h1>Diorite</h1>
	<div class="search">
		<label for="cardSearch">Search</label>
		<div class="container">
			<input name="cardSearch" />
			<div class="autocomplete" id="cardSearchAutocomplete"></div>
		</div>
	</div>
</header>
<section id="main">
	<p>Welcome to Diorite!</p>
	<mtg-card></mtg-card>
</section>
<script src="cssClass.js"></script>
<script src="badPractice.js"></script>
<script>
function loadCard(multiverseId) {
	gs.send("card", multiverseId).response(function(msg) {
		console.log(msg.data);
		$("#main p").text(msg.data.Name);
	});
}

$("header .search input").on("keyup", function() {
	var input = this;
	gs.send("nameSearch", this.value).response(function(msg) {
		var cards = msg.data;
		var autocomplete = $(".autocomplete", input.parentNode);
		cards = cards.map(function(card) {
			return $.create("div")
				.text(card.Name)
				.data("multiverseId", card.MultiverseID)
				.on("mousedown", function() {
					loadCard(parseInt(this.data("multiverseId")));
					input.clear();
					autocomplete.empty();
				});
		});
		autocomplete.empty().append(cards);
	});
}).on("focus", function() {
	this.classList.add("focused");
}).on("blur", function() {
	setTimeout((function() {
		if (!this.hasFocus) {
			this.classList.remove("focused");
		}
	}).bind(this), 150);
});
</script>

<script src="elements/card.js"></script>
</body>
</html>
